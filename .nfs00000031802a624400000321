#!/bin/bash

#SBATCH --job-name=tiSFM
#SBATCH --partition=benos_gpu,dept_gpu
#SBATCH --constraint="A100"
#SBATCH --gres=gpu:1
#SBATCH --output=logs/jupyter/%j.out
#SBATCH --error=logs/jupyter/%j.err

XDG_RUNTIME_DIR=""    

ipnport=$(shuf -i8000-9999 -n1)    
ipnip=$(hostname -i)    
token=$(xxd -l 32 -c 32 -p < /dev/random)    

echo -e "    
Copy/Paste this in your local terminal to ssh tunnel with remote    
-----------------------------------------------------------------    

ssh -N -L $ipnport:$ipnip:$ipnport $USER@cluster
-----------------------------------------------------------------    

Then open a browser on your local machine to the following address    
------------------------------------------------------------------    

http://localhost:$ipnport?token=$token    
------------------------------------------------------------------      
"

jupyter lab --ServerApp.iopub_data_rate_limit=100000000000000  --port=$ipnport --ip=$ipnip --ServerApp.password='' --ServerApp.token="$token" --no-browser
